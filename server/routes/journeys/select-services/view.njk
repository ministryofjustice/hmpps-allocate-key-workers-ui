{% extends "partials/layout.njk" %}
{% from "partials/statusTag/macro.njk" import statusTag %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/warning-text/macro.njk" import govukWarningText %}

{% set pageTitle = 'Select services' %}

{% block innerContent %}
  <div class="govuk-width-container govuk-body">
    <form method="post">
      <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
      {{ govukRadios({
        name: "services",
        errorMessage: validationErrors | findError('services'),
        fieldset: {
          legend: {
            text: "Select which services should be active in " + user.activeCaseLoad.description,
            isPageHeading: true,
            classes: "govuk-fieldset__legend--xl"
          }
        },
        hint: {
          html: govukWarningText({
            text: "Making either key worker or personal officer inactive will remove access to that service for all users in this establishment",
            iconFallbackText: "Warning"
          })
        } if keyWorkerEnabled or personalOfficerEnabled,
        items: [
          {
            value: 'KW',
            text: "Key worker",
            hint: {
              text: "Only key worker will be active in this establishment. If personal officer is currently active, it will be made inactive. Prisoners will not be deallocated and personal officers will not lose their roles."
            },
            checked: services === 'KW'
          } if not (keyWorkerEnabled and not personalOfficerEnabled),
          {
            value: 'PO',
            text: "Personal officer",
            hint: {
            text: "Only personal officer will be active in this establishment. If key worker is currently active, it will be made inactive. Prisoners will not be deallocated and key workers will not lose their roles."
          },
            checked: services === 'PO'
          } if not (personalOfficerEnabled and not keyWorkerEnabled),
          {
            value: 'KWPO',
            text: "Key worker and personal officer",
            hint: {
            text: "Both key worker and personal officer will be active in this establishment. If either are currently active, they will not be affected."
          },
            checked: services === 'KWPO'
          } if not (personalOfficerEnabled and keyWorkerEnabled),
          {
            value: 'NONE',
            text: "Neither",
            hint: {
            text: "Neither key worker or personal officer will be active in this establishment. If either are currently active, they will be deactivated. Prisoners will not be deallocated and key workers or personal officers will not lose their roles."
          },
            checked: services === 'NONE'
          } if personalOfficerEnabled or keyWorkerEnabled
        ] | removeNullish
      }) }}

      <div class="govuk-button-group">
        {{ govukButton({
          text: "Continue",
          preventDoubleClick: true
        }) }}

        {{ govukButton({
          text: "Cancel",
          classes: "govuk-button--secondary",
          href: "/" + policyPath + "/establishment-settings",
          preventDoubleClick: true
        }) }}
      </div>
    </form>
  </div>
{% endblock %}
