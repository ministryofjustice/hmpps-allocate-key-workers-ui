{% from "partials/statusTag/macro.njk" import statusTag %}
{% from "./statCard.njk" import statCard %}

<div class="govuk-grid-row govuk-!-margin-0">
  <h1 class="govuk-heading-l govuk-!-display-inline-block govuk-!-margin-0">{{ staffMember | firstNameSpaceLastName }}</h1>
  <p class="govuk-!-margin-left-2 govuk-!-display-inline-block govuk-!-margin-0 ">
    {{ statusTag({ text: status.description, fullText: true }) }}
  </p>
  {% if user | hasPermission('allocate') %}
    <a class="govuk-!-margin-left-2 govuk-link govuk-link--no-visited-state govuk-!-display-inline-block " href="/{{ policyPath }}/start-update-staff/{{ staffId }}?proceedTo=update-capacity-status-and-working-pattern">Update capacity, status or working pattern</a>
  {% endif %}
</div>
<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible"/>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-quarter left-aligned">
    <h2 class="govuk-heading-s govuk-!-margin-bottom-2">Establishment</h2>
    <p class="govuk-!-margin-bottom-2">{{ user.activeCaseLoad.description }}</p>
  </div>

  <div class="govuk-grid-column-one-quarter left-aligned">
    <h2 class="govuk-heading-s govuk-!-margin-bottom-2">Working pattern</h2>
    <p class="govuk-!-margin-bottom-2">{{ staffRole.scheduleType.description }}</p>
  </div>

  <div class="govuk-grid-column-one-quarter left-aligned">
    <h2 class="govuk-heading-s govuk-!-margin-bottom-2">Prisoners allocated</h2>
    <p class="govuk-!-margin-bottom-2">{{ allocated }}</p>
  </div>

  <div class="govuk-grid-column-one-quarter left-aligned">
    <h2 class="govuk-heading-s govuk-!-margin-bottom-2">Maximum capacity</h2>
    <p class="govuk-!-margin-bottom-2">{{ capacity }}</p>
  </div>
</div>

<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible"/>

<h2 class="govuk-body-l">
  <strong>Statistics for period:</strong>
  Displaying statistics from {{ stats.current.from | dateString }} to {{ stats.current.to | dateString }}. Comparing against statistics from {{ stats.previous.from | dateString }} to {{ stats.previous.to | dateString }}.
</h2>
<div class="govuk-grid-row">
  {{ statCard('Projected sessions', stats.current.projectedComplianceEvents, stats.previous.projectedComplianceEvents ) }}

  {{ statCard('Recorded case note sessions', stats.current.recordedComplianceEvents, stats.previous.recordedComplianceEvents ) }}

  {{ statCard('Session compliance', stats.current.complianceRate, stats.previous.complianceRate, 'percentage') }}

  {{ statCard('Recorded case note entries', stats.current.recordedEvents | mapProperty('count') | sum, stats.previous.recordedEvents | mapProperty('count') | sum) }}
</div>
<p class="govuk-!-margin-top-5">These figures are estimates based on the number of prisoners currently allocated to this {{ policyStaff }}. If their allocations have changed during the reporting period these figures may not be correct.</p>

<hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible"/>

<hr class="govuk-section-break govuk-section-break--m"/>
